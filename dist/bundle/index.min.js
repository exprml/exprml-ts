!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@bufbuild/protobuf/codegenv1"),require("@bufbuild/protobuf"),require("yaml")):"function"==typeof define&&define.amd?define(["exports","@bufbuild/protobuf/codegenv1","@bufbuild/protobuf","yaml"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).eyamluate={},e.codegenv1,e.protobuf,e.YAML)}(this,(function(e,t,a,r){"use strict";const u=t.fileDesc("ChVleHBybWwvdjEvdmFsdWUucHJvdG8SCWV4cHJtbC52MSKqAgoFVmFsdWUSIwoEdHlwZRgBIAEoDjIVLmV4cHJtbC52MS5WYWx1ZS5UeXBlEgwKBGJvb2wYAiABKAgSCwoDbnVtGAMgASgBEgsKA3N0chgEIAEoCRIdCgNhcnIYBSADKAsyEC5leHBybWwudjEuVmFsdWUSJgoDb2JqGAYgAygLMhkuZXhwcm1sLnYxLlZhbHVlLk9iakVudHJ5GjwKCE9iakVudHJ5EgsKA2tleRgBIAEoCRIfCgV2YWx1ZRgCIAEoCzIQLmV4cHJtbC52MS5WYWx1ZToCOAEiTwoEVHlwZRIPCgtVTlNQRUNJRklFRBAAEggKBE5VTEwQARIICgRCT09MEAISBwoDTlVNEAMSBwoDU1RSEAQSBwoDQVJSEAUSBwoDT0JKEAZCYAoNY29tLmV4cHJtbC52MUIKVmFsdWVQcm90b1ABogIDRVhYqgIJRXhwcm1sLlYxygIJRXhwcm1sXFYx4gIVRXhwcm1sXFYxXEdQQk1ldGFkYXRh6gIKRXhwcm1sOjpWMWIGcHJvdG8z"),n=t.messageDesc(u,0);var s;e.Value_Type=void 0,(s=e.Value_Type||(e.Value_Type={}))[s.UNSPECIFIED=0]="UNSPECIFIED",s[s.NULL=1]="NULL",s[s.BOOL=2]="BOOL",s[s.NUM=3]="NUM",s[s.STR=4]="STR",s[s.ARR=5]="ARR",s[s.OBJ=6]="OBJ";const c=t.enumDesc(u,0,0),o=t.fileDesc("ChdleHBybWwvdjEvZW5jb2Rlci5wcm90bxIJZXhwcm1sLnYxInsKC0VuY29kZUlucHV0Ei0KBmZvcm1hdBgBIAEoDjIdLmV4cHJtbC52MS5FbmNvZGVJbnB1dC5Gb3JtYXQSHwoFdmFsdWUYAyABKAsyEC5leHBybWwudjEuVmFsdWUiHAoGRm9ybWF0EggKBEpTT04QABIICgRZQU1MEAEiRQoMRW5jb2RlT3V0cHV0EhAKCGlzX2Vycm9yGAEgASgIEhUKDWVycm9yX21lc3NhZ2UYAiABKAkSDAoEdGV4dBgDIAEoCTJGCgdFbmNvZGVyEjsKBkVuY29kZRIWLmV4cHJtbC52MS5FbmNvZGVJbnB1dBoXLmV4cHJtbC52MS5FbmNvZGVPdXRwdXQiAEJiCg1jb20uZXhwcm1sLnYxQgxFbmNvZGVyUHJvdG9QAaICA0VYWKoCCUV4cHJtbC5WMcoCCUV4cHJtbFxWMeICFUV4cHJtbFxWMVxHUEJNZXRhZGF0YeoCCkV4cHJtbDo6VjFiBnByb3RvMw",[u]),p=t.messageDesc(o,0);var l;e.EncodeInput_Format=void 0,(l=e.EncodeInput_Format||(e.EncodeInput_Format={}))[l.JSON=0]="JSON",l[l.YAML=1]="YAML";const i=t.enumDesc(o,0,0),E=t.messageDesc(o,1),y=t.fileDesc("ChdleHBybWwvdjEvZGVjb2Rlci5wcm90bxIJZXhwcm1sLnYxIhsKC0RlY29kZUlucHV0EgwKBHRleHQYASABKAkiWAoMRGVjb2RlT3V0cHV0EhAKCGlzX2Vycm9yGAEgASgIEhUKDWVycm9yX21lc3NhZ2UYAiABKAkSHwoFdmFsdWUYAyABKAsyEC5leHBybWwudjEuVmFsdWUyRgoHRGVjb2RlchI7CgZEZWNvZGUSFi5leHBybWwudjEuRGVjb2RlSW5wdXQaFy5leHBybWwudjEuRGVjb2RlT3V0cHV0IgBCYgoNY29tLmV4cHJtbC52MUIMRGVjb2RlclByb3RvUAGiAgNFWFiqAglFeHBybWwuVjHKAglFeHBybWxcVjHiAhVFeHBybWxcVjFcR1BCTWV0YWRhdGHqAgpFeHBybWw6OlYxYgZwcm90bzM",[u]),h=t.messageDesc(y,0),d=t.messageDesc(y,1),A=t.fileDesc("ChRleHBybWwvdjEvZXhwci5wcm90bxIJZXhwcm1sLnYxIp0GCgRFeHByEiIKBHBhdGgYASABKAsyFC5leHBybWwudjEuRXhwci5QYXRoEh8KBXZhbHVlGAIgASgLMhAuZXhwcm1sLnYxLlZhbHVlEiIKBGtpbmQYAyABKA4yFC5leHBybWwudjEuRXhwci5LaW5kEh0KBGV2YWwYCiABKAsyDy5leHBybWwudjEuRXZhbBIhCgZzY2FsYXIYCyABKAsyES5leHBybWwudjEuU2NhbGFyEhsKA3JlZhgMIAEoCzIOLmV4cHJtbC52MS5SZWYSGwoDb2JqGA0gASgLMg4uZXhwcm1sLnYxLk9iahIbCgNhcnIYDiABKAsyDi5leHBybWwudjEuQXJyEh0KBGpzb24YDyABKAsyDy5leHBybWwudjEuSnNvbhIdCgRpdGVyGBAgASgLMg8uZXhwcm1sLnYxLkl0ZXISHQoEZWxlbRgRIAEoCzIPLmV4cHJtbC52MS5FbGVtEh0KBGNhbGwYEiABKAsyDy5leHBybWwudjEuQ2FsbBIfCgVjYXNlcxgTIAEoCzIQLmV4cHJtbC52MS5DYXNlcxIkCghvcF91bmFyeRgUIAEoCzISLmV4cHJtbC52MS5PcFVuYXJ5EiYKCW9wX2JpbmFyeRgVIAEoCzITLmV4cHJtbC52MS5PcEJpbmFyeRIqCgtvcF92YXJpYWRpYxgWIAEoCzIVLmV4cHJtbC52MS5PcFZhcmlhZGljGlAKBFBhdGgSJQoDcG9zGAEgAygLMhguZXhwcm1sLnYxLkV4cHIuUGF0aC5Qb3MaIQoDUG9zEg0KBWluZGV4GAEgASgDEgsKA2tleRgCIAEoCSKpAQoES2luZBIPCgtVTlNQRUNJRklFRBAAEggKBEVWQUwQChIKCgZTQ0FMQVIQCxIHCgNSRUYQDBIHCgNPQkoQDRIHCgNBUlIQDhIICgRKU09OEA8SCAoESVRFUhAQEggKBEVMRU0QERIICgRDQUxMEBISCQoFQ0FTRVMQExIMCghPUF9VTkFSWRAUEg0KCU9QX0JJTkFSWRAVEg8KC09QX1ZBUklBRElDEBYimgEKBEV2YWwSHQoEZXZhbBgBIAEoCzIPLmV4cHJtbC52MS5FeHByEikKBXdoZXJlGAIgAygLMhouZXhwcm1sLnYxLkV2YWwuRGVmaW5pdGlvbhpICgpEZWZpbml0aW9uEg0KBWlkZW50GAEgASgJEgwKBGFyZ3MYAiADKAkSHQoEYm9keRgDIAEoCzIPLmV4cHJtbC52MS5FeHByIioKBlNjYWxhchIgCgZzY2FsYXIYASABKAsyEC5leHBybWwudjEuVmFsdWUiFAoDUmVmEg0KBWlkZW50GAEgASgJImgKA09iahIkCgNvYmoYASADKAsyFy5leHBybWwudjEuT2JqLk9iakVudHJ5GjsKCE9iakVudHJ5EgsKA2tleRgBIAEoCRIeCgV2YWx1ZRgCIAEoCzIPLmV4cHJtbC52MS5FeHByOgI4ASIjCgNBcnISHAoDYXJyGAEgAygLMg8uZXhwcm1sLnYxLkV4cHIiJgoESnNvbhIeCgRqc29uGAEgASgLMhAuZXhwcm1sLnYxLlZhbHVlIoUBCgRJdGVyEhEKCXBvc19pZGVudBgBIAEoCRISCgplbGVtX2lkZW50GAIgASgJEhwKA2NvbBgDIAEoCzIPLmV4cHJtbC52MS5FeHByEhsKAmRvGAQgASgLMg8uZXhwcm1sLnYxLkV4cHISGwoCaWYYBSABKAsyDy5leHBybWwudjEuRXhwciJDCgRFbGVtEhwKA2dldBgBIAEoCzIPLmV4cHJtbC52MS5FeHByEh0KBGZyb20YAiABKAsyDy5leHBybWwudjEuRXhwciJ8CgRDYWxsEg0KBWlkZW50GAEgASgJEicKBGFyZ3MYAiADKAsyGS5leHBybWwudjEuQ2FsbC5BcmdzRW50cnkaPAoJQXJnc0VudHJ5EgsKA2tleRgBIAEoCRIeCgV2YWx1ZRgCIAEoCzIPLmV4cHJtbC52MS5FeHByOgI4ASKtAQoFQ2FzZXMSJAoFY2FzZXMYASADKAsyFS5leHBybWwudjEuQ2FzZXMuQ2FzZRp+CgRDYXNlEhQKDGlzX290aGVyd2lzZRgBIAEoCBIdCgR3aGVuGAIgASgLMg8uZXhwcm1sLnYxLkV4cHISHQoEdGhlbhgDIAEoCzIPLmV4cHJtbC52MS5FeHByEiIKCW90aGVyd2lzZRgEIAEoCzIPLmV4cHJtbC52MS5FeHByIqEBCgdPcFVuYXJ5EiEKAm9wGAEgASgOMhUuZXhwcm1sLnYxLk9wVW5hcnkuT3ASIAoHb3BlcmFuZBgCIAEoCzIPLmV4cHJtbC52MS5FeHByIlEKAk9wEg8KC1VOU1BFQ0lGSUVEEAASBwoDTEVOEAESBwoDTk9UEAISCAoERkxBVBADEgkKBUZMT09SEAQSCAoEQ0VJTBAFEgkKBUFCT1JUEAYiyQEKCE9wQmluYXJ5EiIKAm9wGAEgASgOMhYuZXhwcm1sLnYxLk9wQmluYXJ5Lk9wEh0KBGxlZnQYAiABKAsyDy5leHBybWwudjEuRXhwchIeCgVyaWdodBgDIAEoCzIPLmV4cHJtbC52MS5FeHByIloKAk9wEg8KC1VOU1BFQ0lGSUVEEAASBwoDU1VCEAESBwoDRElWEAISBgoCRVEQAxIHCgNORVEQBBIGCgJMVBAFEgcKA0xURRAGEgYKAkdUEAcSBwoDR1RFEAgitQEKCk9wVmFyaWFkaWMSJAoCb3AYASABKA4yGC5leHBybWwudjEuT3BWYXJpYWRpYy5PcBIhCghvcGVyYW5kcxgCIAMoCzIPLmV4cHJtbC52MS5FeHByIl4KAk9wEg8KC1VOU1BFQ0lGSUVEEAASBwoDQUREEAESBwoDTVVMEAISBwoDQU5EEAMSBgoCT1IQBBIHCgNDQVQQBRIHCgNNSU4QBhIHCgNNQVgQBxIJCgVNRVJHRRAIQl8KDWNvbS5leHBybWwudjFCCUV4cHJQcm90b1ABogIDRVhYqgIJRXhwcm1sLlYxygIJRXhwcm1sXFYx4gIVRXhwcm1sXFYxXEdQQk1ldGFkYXRh6gIKRXhwcm1sOjpWMWIGcHJvdG8z",[u]),O=t.messageDesc(A,0),V=t.messageDesc(A,0,0),g=t.messageDesc(A,0,0,0);var f;e.Expr_Kind=void 0,(f=e.Expr_Kind||(e.Expr_Kind={}))[f.UNSPECIFIED=0]="UNSPECIFIED",f[f.EVAL=10]="EVAL",f[f.SCALAR=11]="SCALAR",f[f.REF=12]="REF",f[f.OBJ=13]="OBJ",f[f.ARR=14]="ARR",f[f.JSON=15]="JSON",f[f.ITER=16]="ITER",f[f.ELEM=17]="ELEM",f[f.CALL=18]="CALL",f[f.CASES=19]="CASES",f[f.OP_UNARY=20]="OP_UNARY",f[f.OP_BINARY=21]="OP_BINARY",f[f.OP_VARIADIC=22]="OP_VARIADIC";const S=t.enumDesc(A,0,0),b=t.messageDesc(A,1),B=t.messageDesc(A,1,0),_=t.messageDesc(A,2),m=t.messageDesc(A,3),R=t.messageDesc(A,4),v=t.messageDesc(A,5),I=t.messageDesc(A,6),C=t.messageDesc(A,7),T=t.messageDesc(A,8),w=t.messageDesc(A,9),x=t.messageDesc(A,10),U=t.messageDesc(A,10,0),N=t.messageDesc(A,11);var F;e.OpUnary_Op=void 0,(F=e.OpUnary_Op||(e.OpUnary_Op={}))[F.UNSPECIFIED=0]="UNSPECIFIED",F[F.LEN=1]="LEN",F[F.NOT=2]="NOT",F[F.FLAT=3]="FLAT",F[F.FLOOR=4]="FLOOR",F[F.CEIL=5]="CEIL",F[F.ABORT=6]="ABORT";const K=t.enumDesc(A,11,0),L=t.messageDesc(A,12);var M;e.OpBinary_Op=void 0,(M=e.OpBinary_Op||(e.OpBinary_Op={}))[M.UNSPECIFIED=0]="UNSPECIFIED",M[M.SUB=1]="SUB",M[M.DIV=2]="DIV",M[M.EQ=3]="EQ",M[M.NEQ=4]="NEQ",M[M.LT=5]="LT",M[M.LTE=6]="LTE",M[M.GT=7]="GT",M[M.GTE=8]="GTE";const j=t.enumDesc(A,12,0),D=t.messageDesc(A,13);var H;e.OpVariadic_Op=void 0,(H=e.OpVariadic_Op||(e.OpVariadic_Op={}))[H.UNSPECIFIED=0]="UNSPECIFIED",H[H.ADD=1]="ADD",H[H.MUL=2]="MUL",H[H.AND=3]="AND",H[H.OR=4]="OR",H[H.CAT=5]="CAT",H[H.MIN=6]="MIN",H[H.MAX=7]="MAX",H[H.MERGE=8]="MERGE";const J=t.enumDesc(A,13,0),k=t.fileDesc("ChlleHBybWwvdjEvZXZhbHVhdG9yLnByb3RvEglleHBybWwudjEiWAoIRGVmU3RhY2sSIwoGcGFyZW50GAEgASgLMhMuZXhwcm1sLnYxLkRlZlN0YWNrEicKA2RlZhgCIAEoCzIaLmV4cHJtbC52MS5FdmFsLkRlZmluaXRpb24iVgoNRXZhbHVhdGVJbnB1dBImCglkZWZfc3RhY2sYASABKAsyEy5leHBybWwudjEuRGVmU3RhY2sSHQoEZXhwchgCIAEoCzIPLmV4cHJtbC52MS5FeHByIoUDCg5FdmFsdWF0ZU91dHB1dBIwCgZzdGF0dXMYASABKA4yIC5leHBybWwudjEuRXZhbHVhdGVPdXRwdXQuU3RhdHVzEhUKDWVycm9yX21lc3NhZ2UYAiABKAkSKAoKZXJyb3JfcGF0aBgDIAEoCzIULmV4cHJtbC52MS5FeHByLlBhdGgSHwoFdmFsdWUYBCABKAsyEC5leHBybWwudjEuVmFsdWUi3gEKBlN0YXR1cxIGCgJPSxAAEhEKDUlOVkFMSURfSU5ERVgQZBIPCgtJTlZBTElEX0tFWRBlEhMKD1VORVhQRUNURURfVFlQRRBmEhUKEUFSR1VNRU5UX01JU01BVENIEGcSGAoUQ0FTRVNfTk9UX0VYSEFVU1RJVkUQaBIXChNSRUZFUkVOQ0VfTk9UX0ZPVU5EEGkSEgoOTk9UX0NPTVBBUkFCTEUQahIVChFOT1RfRklOSVRFX05VTUJFUhBrEgsKB0FCT1JURUQQbBIRCg1VTktOT1dOX0VSUk9SEG0yTgoJRXZhbHVhdG9yEkEKCEV2YWx1YXRlEhguZXhwcm1sLnYxLkV2YWx1YXRlSW5wdXQaGS5leHBybWwudjEuRXZhbHVhdGVPdXRwdXQiAEJkCg1jb20uZXhwcm1sLnYxQg5FdmFsdWF0b3JQcm90b1ABogIDRVhYqgIJRXhwcm1sLlYxygIJRXhwcm1sXFYx4gIVRXhwcm1sXFYxXEdQQk1ldGFkYXRh6gIKRXhwcm1sOjpWMWIGcHJvdG8z",[A,u]),Y=t.messageDesc(k,0),W=t.messageDesc(k,1),G=t.messageDesc(k,2);var X;e.EvaluateOutput_Status=void 0,(X=e.EvaluateOutput_Status||(e.EvaluateOutput_Status={}))[X.OK=0]="OK",X[X.INVALID_INDEX=100]="INVALID_INDEX",X[X.INVALID_KEY=101]="INVALID_KEY",X[X.UNEXPECTED_TYPE=102]="UNEXPECTED_TYPE",X[X.ARGUMENT_MISMATCH=103]="ARGUMENT_MISMATCH",X[X.CASES_NOT_EXHAUSTIVE=104]="CASES_NOT_EXHAUSTIVE",X[X.REFERENCE_NOT_FOUND=105]="REFERENCE_NOT_FOUND",X[X.NOT_COMPARABLE=106]="NOT_COMPARABLE",X[X.NOT_FINITE_NUMBER=107]="NOT_FINITE_NUMBER",X[X.ABORTED=108]="ABORTED",X[X.UNKNOWN_ERROR=109]="UNKNOWN_ERROR";const Z=t.enumDesc(k,2,0),Q=t.fileDesc("ChZleHBybWwvdjEvcGFyc2VyLnByb3RvEglleHBybWwudjEiLQoKUGFyc2VJbnB1dBIfCgV2YWx1ZRgBIAEoCzIQLmV4cHJtbC52MS5WYWx1ZSJVCgtQYXJzZU91dHB1dBIQCghpc19lcnJvchgBIAEoCBIVCg1lcnJvcl9tZXNzYWdlGAIgASgJEh0KBGV4cHIYAyABKAsyDy5leHBybWwudjEuRXhwcjJCCgZQYXJzZXISOAoFUGFyc2USFS5leHBybWwudjEuUGFyc2VJbnB1dBoWLmV4cHJtbC52MS5QYXJzZU91dHB1dCIAQmEKDWNvbS5leHBybWwudjFCC1BhcnNlclByb3RvUAGiAgNFWFiqAglFeHBybWwuVjHKAglFeHBybWxcVjHiAhVFeHBybWxcVjFcR1BCTWV0YWRhdGHqAgpFeHBybWw6OlYxYgZwcm90bzM",[A,u]),P=t.messageDesc(Q,0),$=t.messageDesc(Q,1);function z(t){if(null==t)return a.create(n,{type:e.Value_Type.NULL});if(Array.isArray(t))return a.create(n,{type:e.Value_Type.ARR,arr:t.map(z)});switch(typeof t){case"boolean":return a.create(n,{type:e.Value_Type.BOOL,bool:t});case"number":return a.create(n,{type:e.Value_Type.NUM,num:t});case"string":return a.create(n,{type:e.Value_Type.STR,str:t});case"object":return a.create(n,{type:e.Value_Type.OBJ,obj:Object.fromEntries(Object.entries(t).map((([e,t])=>[e,z(t)])))})}throw new Error("unexpected value type")}function q(t){switch(t.type){case e.Value_Type.NULL:return null;case e.Value_Type.BOOL:return t.bool;case e.Value_Type.NUM:return t.num;case e.Value_Type.STR:return t.str;case e.Value_Type.OBJ:return Object.fromEntries(Object.entries(t.obj).map((([e,t])=>[e,q(t)])));case e.Value_Type.ARR:return t.arr.map(q);default:throw new Error("unexpected value type")}}function ee(e,...t){const r=[...t].map((e=>"string"==typeof e?a.create(g,{key:e}):a.create(g,{index:BigInt(e)})));return a.create(V,{pos:[...e.pos,...r]})}function te(e){return 0===e.pos.length?"/":[...e.pos].map((e=>""!==e.key?`/${e.key}`:`/${e.index}`)).join("")}const ae=/[^$_a-zA-Z0-9]/g,re=/^\$[_a-zA-Z][_a-zA-Z0-9]*(\(\s*\)|\(\s*\$[_a-zA-Z][_a-zA-Z0-9]*(\s*,\s*\$[_a-zA-Z][_a-zA-Z0-9]*)*(\s*,)?\s*\))?$/,ue=/^for\(\s*\$[_a-zA-Z][_a-zA-Z0-9]*\s*,\s*\$[_a-zA-Z][_a-zA-Z0-9]*\s*\)$/,ne=/^\$[_a-zA-Z][_a-zA-Z0-9]*$/;function se(t,r){switch(r.type){case e.Value_Type.STR:if(ne.test(r.str))return a.create(O,{kind:e.Expr_Kind.REF,path:t,ref:a.create(m,{ident:r.str})});if(/^`.*`$/.test(r.str))return a.create(O,{kind:e.Expr_Kind.SCALAR,path:t,scalar:a.create(_,{scalar:a.create(n,{type:e.Value_Type.STR,str:r.str.slice(1,-1)})})});throw new Error(`invalid Scalar: ${t}: string literal must be enclosed by \`'\``);case e.Value_Type.BOOL:case e.Value_Type.NUM:return a.create(O,{kind:e.Expr_Kind.SCALAR,path:t,scalar:a.create(_,{scalar:r})});case e.Value_Type.OBJ:if("eval"in r.obj){const u=a.create(b,{eval:se(ee(t,"eval"),r.obj.eval)});if("where"in r.obj){const n=r.obj.where;if(n.type!==e.Value_Type.ARR)throw new Error(`invalid Expr: ${te(ee(t,"where"))}: where clause must be an array`);const s=[];for(let r=0;r<n.arr.length;r++){const u=n.arr[r];if(u.type!==e.Value_Type.OBJ)throw new Error(`invalid definition: ${te(ee(t,"where",r))}: where clause must contain only objects but got ${u.type}`);const c=Object.keys(u.obj);if(1!==c.length)throw new Error(`invalid definition: ${te(ee(t,"where",r))}: definition must contain one property`);const o=c[0];if(!re.test(o))throw new Error(`invalid definition: ${te(ee(t,"where",r,o))}: definition must match ${re}`);const p=o.replaceAll(ae,"").split("$").map((e=>"$"+e));s.push(a.create(B,{ident:p[1],args:p.slice(2),body:se(ee(t,"where",r,o),u.obj[o])}))}u.where=s}return a.create(O,{kind:e.Expr_Kind.EVAL,path:t,eval:u})}if("obj"in r.obj){const u=r.obj.obj;if(u.type!==e.Value_Type.OBJ)throw new Error(`invalid Obj: ${te(ee(t,"obj"))}: 'obj' property must be an object`);const n=Object.fromEntries(Object.entries(u.obj).map((([e,a])=>[e,se(ee(t,"obj",e),a)])));return a.create(O,{kind:e.Expr_Kind.OBJ,path:t,obj:a.create(R,{obj:n})})}if("arr"in r.obj){const u=r.obj.arr;if(u.type!==e.Value_Type.ARR)throw new Error(`invalid Arr: ${te(ee(t,"arr"))}: 'arr' property must be an array`);const n=u.arr.map(((e,a)=>se(ee(t,"arr",a),e)));return a.create(O,{kind:e.Expr_Kind.ARR,path:t,arr:a.create(v,{arr:n})})}if("json"in r.obj){if(ce(r.obj.json))throw new Error(`invalid Json: ${te(ee(t,"json"))}: 'json' property cannot contain null`);return a.create(O,{kind:e.Expr_Kind.JSON,path:t,json:a.create(I,{json:r.obj.json})})}if("do"in r.obj){const u=a.create(C,{});for(const e of Object.keys(r.obj))if("do"!==e)if("if"!==e){if(!ue.test(e))throw new Error(`invalid Iter: ${te(ee(t,"do",e))}: invalid property ${e}`);{const a=e.replaceAll(ae,"").split("$").map((e=>"$"+e));u.posIdent=a[1],u.elemIdent=a[2],u.col=se(ee(t,e),r.obj[e])}}else u.if=se(ee(t,"if"),r.obj.if);else u.do=se(ee(t,"do"),r.obj.do);if(!u.col)throw new Error(`invalid Iter: ${te(t)}: 'for(...vars...)' property is required`);return a.create(O,{kind:e.Expr_Kind.ITER,path:t,iter:u})}if("get"in r.obj){if(!("from"in r.obj))throw new Error(`invalid Elem: ${te(t)}: 'from' property is required`);const u=a.create(T,{get:se(ee(t,"get"),r.obj.get),from:se(ee(t,"from"),r.obj.from)});return a.create(O,{kind:e.Expr_Kind.ELEM,path:t,elem:u})}if("cases"in r.obj){const u=r.obj.cases;if(u.type!==e.Value_Type.ARR)throw new Error(`invalid Cases: ${te(ee(t,"cases"))}: 'cases' property must be an array`);const n=[];for(let r=0;r<u.arr.length;r++){const s=u.arr[r];if(s.type!==e.Value_Type.OBJ)throw new Error(`invalid Case: ${te(ee(t,"cases",r))}: 'cases' property must contain only objects but got ${s.type}`);if("otherwise"in s.obj){const e=se(ee(t,"cases",r,"otherwise"),s.obj.otherwise);n.push(a.create(U,{isOtherwise:!0,otherwise:e}))}else{if(!("when"in s.obj))throw new Error(`invalid Case: ${te(ee(t,"cases",r))}: 'when' property is required`);const e=se(ee(t,"cases",r,"when"),s.obj.when);if(!("then"in s.obj))throw new Error(`invalid Case: ${te(ee(t,"cases",r))}: 'then' property is required`);const u=se(ee(t,"cases",r,"then"),s.obj.then);n.push(a.create(U,{when:e,then:u}))}}return a.create(O,{kind:e.Expr_Kind.CASES,path:t,cases:a.create(x,{cases:n})})}if(1!==Object.keys(r.obj).length)throw new Error(`invalid Expr: ${te(t)}: operation or function call must contain only one property`);const u=Object.keys(r.obj)[0];{const n={len:e.OpUnary_Op.LEN,not:e.OpUnary_Op.NOT,flat:e.OpUnary_Op.FLAT,floor:e.OpUnary_Op.FLOOR,ceil:e.OpUnary_Op.CEIL,abort:e.OpUnary_Op.ABORT}[u];if(n)return a.create(O,{kind:e.Expr_Kind.OP_UNARY,path:t,opUnary:a.create(N,{op:n,operand:se(ee(t,u),r.obj[u])})})}{const n={sub:e.OpBinary_Op.SUB,div:e.OpBinary_Op.DIV,eq:e.OpBinary_Op.EQ,neq:e.OpBinary_Op.NEQ,lt:e.OpBinary_Op.LT,lte:e.OpBinary_Op.LTE,gt:e.OpBinary_Op.GT,gte:e.OpBinary_Op.GTE}[u];if(n){if(r.obj[u].type!==e.Value_Type.ARR)throw new Error(`invalid OpBinary: ${te(ee(t,u))}: '${u}' property must be an array`);if(2!==r.obj[u].arr.length)throw new Error(`invalid OpBinary: ${te(ee(t,u))}: '${u}' property must contain two elements`);return a.create(O,{kind:e.Expr_Kind.OP_BINARY,path:t,opBinary:a.create(L,{op:n,left:se(ee(t,u,0),r.obj[u].arr[0]),right:se(ee(t,u,1),r.obj[u].arr[1])})})}}{const n={add:e.OpVariadic_Op.ADD,mul:e.OpVariadic_Op.MUL,and:e.OpVariadic_Op.AND,or:e.OpVariadic_Op.OR,cat:e.OpVariadic_Op.CAT,min:e.OpVariadic_Op.MIN,max:e.OpVariadic_Op.MAX,merge:e.OpVariadic_Op.MERGE}[u];if(n){if(r.obj[u].type!==e.Value_Type.ARR)throw new Error(`invalid OpVariadic: ${te(ee(t,u))}: '${u}' property must be an array`);if(("min"===u||"max"===u)&&0===r.obj[u].arr.length)throw new Error(`invalid OpVariadic: ${te(ee(t,u))}: '${u}' property must contain at least one element`);const s=r.obj[u].arr.map(((e,a)=>se(ee(t,u,a),e)));return a.create(O,{kind:e.Expr_Kind.OP_VARIADIC,path:t,opVariadic:a.create(D,{op:n,operands:s})})}}{if(!ne.test(u))throw new Error(`invalid Call: ${te(t)}: function call property '${u}' must match '${ne}'`);const n=r.obj[u];if(n.type!==e.Value_Type.OBJ)throw new Error(`invalid Call: ${te(ee(t,u))}: arguments must be given as an object`);const s={};for(const[e,a]of Object.entries(n.obj)){if(!ne.test(e))throw new Error(`invalid Call: ${te(ee(t,u,e))}: argument property '${e}' must match '${ne}'`);s[e]=se(ee(t,u,e),a)}return a.create(O,{kind:e.Expr_Kind.CALL,path:t,call:a.create(w,{ident:u,args:s})})}default:throw new Error("unexpected value type")}}function ce(t){if(t.type===e.Value_Type.NULL)return!0;for(const e of Object.values(t.obj))if(ce(e))return!0;for(const e of t.arr)if(ce(e))return!0;return!1}function oe(e,t){return a.create(Y,{parent:e,def:t})}function pe(e,t){return null==e||null==e.def?null:e.def?.ident===t?e:null==e.parent?null:pe(e.parent,t)}function le(t,r,u){return a.create(B,{ident:r,body:a.create(O,{path:t,kind:e.Expr_Kind.JSON,value:u,json:a.create(I,{json:u})})})}function ie(t){return a.create(n,{type:e.Value_Type.OBJ,obj:t})}function Ee(t){return a.create(n,{type:e.Value_Type.ARR,arr:t})}function ye(t){return a.create(n,{type:e.Value_Type.STR,str:t})}function he(t){return a.create(n,{type:e.Value_Type.NUM,num:t})}function de(t){return a.create(n,{type:e.Value_Type.BOOL,bool:t})}class Ae{constructor(e){this.extension=e?.extension??new Map,this.beforeEvaluate=e?.beforeEvaluate??(()=>{}),this.afterEvaluate=e?.afterEvaluate??(()=>{})}extension;beforeEvaluate;afterEvaluate}function Oe(t,r,u,n){return a.create(G,{status:e.EvaluateOutput_Status.INVALID_INDEX,errorPath:t,errorMessage:`invalid index: index out of bounds: ${r.num} not in [${u}, ${n})`})}function Ve(t,r){return a.create(G,{status:e.EvaluateOutput_Status.INVALID_INDEX,errorPath:t,errorMessage:`invalid index: non integer index: ${r}`})}function ge(t,r,u){const n=u.map((e=>e.toString()));return a.create(G,{status:e.EvaluateOutput_Status.UNEXPECTED_TYPE,errorPath:t,errorMessage:`unexpected type: got ${r.toString()}, want {${n.join(",")}}`})}function fe(t,r){return a.create(G,{status:e.EvaluateOutput_Status.ARGUMENT_MISMATCH,errorPath:t,errorMessage:`argument mismatch: argument "${r}" required`})}function Se(t,r){return a.create(G,{status:e.EvaluateOutput_Status.REFERENCE_NOT_FOUND,errorPath:t,errorMessage:`reference not found: "${r}"`})}function be(t){return a.create(G,{status:e.EvaluateOutput_Status.NOT_COMPARABLE,errorPath:t,errorMessage:"not comparable"})}function Be(t){return a.create(G,{status:e.EvaluateOutput_Status.NOT_FINITE_NUMBER,errorPath:t,errorMessage:"not finite number"})}function _e(t){return t.type===e.Value_Type.NUM&&t.num===Math.floor(t.num)}function me(e){return Object.keys(e).sort()}function Re(t,a){const r=de(!1),u=de(!0);if(t.type!==a.type)return r;switch(t.type){case e.Value_Type.NUM:return de(t.num===a.num);case e.Value_Type.BOOL:return de(t.bool===a.bool);case e.Value_Type.STR:return de(t.str===a.str);case e.Value_Type.ARR:if(t.arr.length!==a.arr.length)return r;for(let e=0;e<t.arr.length;e++)if(!Re(t.arr[e],a.arr[e]).bool)return r;return u;case e.Value_Type.OBJ:const n=me(t.obj),s=me(a.obj);if(n.length!==s.length||!n.every(((e,t)=>e===s[t])))return r;for(const e of n)if(!Re(t.obj[e],a.obj[e]).bool)return r;return u;default:throw new Error(`unexpected type ${t.type}`)}}function ve(t,r,u){const n=a.create(G,{value:he(-1)}),s=a.create(G,{value:he(1)}),c=a.create(G,{value:he(0)});switch(r.type){case e.Value_Type.NUM:return u.type!==e.Value_Type.NUM?be(t):r.num<u.num?n:r.num>u.num?s:c;case e.Value_Type.BOOL:return u.type!==e.Value_Type.BOOL?be(t):!r.bool&&u.bool?n:r.bool&&!u.bool?s:c;case e.Value_Type.STR:return u.type!==e.Value_Type.STR?be(t):r.str<u.str?n:r.str>u.str?s:c;case e.Value_Type.ARR:if(u.type!==e.Value_Type.ARR)return be(t);const a=Math.min(r.arr.length,u.arr.length);for(let n=0;n<a;n++){const a=ve(t,r.arr[n],u.arr[n]);if(a.status!==e.EvaluateOutput_Status.OK)return a;if(0!==a.value.num)return a}return r.arr.length<u.arr.length?n:r.arr.length>u.arr.length?s:c;default:return be(t)}}e.ArrSchema=v,e.CallSchema=w,e.CasesSchema=x,e.Cases_CaseSchema=U,e.Config=Ae,e.DecodeInputSchema=h,e.DecodeOutputSchema=d,e.Decoder=class{decode(e){try{return a.create(d,{isError:!1,value:z(r.parse(e.text))})}catch(e){return a.create(d,{isError:!0,errorMessage:e instanceof Error?e.message:JSON.stringify(e)})}}},e.DefStackSchema=Y,e.ElemSchema=T,e.EncodeInputSchema=p,e.EncodeInput_FormatSchema=i,e.EncodeOutputSchema=E,e.Encoder=class{encode(t){try{switch(t.format){case e.EncodeInput_Format.YAML:return a.create(E,{text:r.stringify(q(t.value))});case e.EncodeInput_Format.JSON:return a.create(E,{text:JSON.stringify(q(t.value))});default:return a.create(E,{isError:!0,errorMessage:`unsupported format: ${e.EncodeInput_Format[t.format]}`})}}catch(e){return a.create(E,{isError:!0,errorMessage:e instanceof Error?e.message:JSON.stringify(e)})}}},e.EvalSchema=b,e.Eval_DefinitionSchema=B,e.EvaluateInputSchema=W,e.EvaluateOutputSchema=G,e.EvaluateOutput_StatusSchema=Z,e.Evaluator=class{constructor(e=new Ae){this.config=e}config;evaluateExpr(t){try{this.config.beforeEvaluate(t)}catch(r){return a.create(G,{status:e.EvaluateOutput_Status.UNKNOWN_ERROR,errorPath:t.expr.path,errorMessage:`beforeEvaluate failed: ${r instanceof Error?r.message:JSON.stringify(r)}`})}let r;switch(t.expr.kind){default:throw new Error("given expression must be validated");case e.Expr_Kind.EVAL:r=this.evaluateEval(t);break;case e.Expr_Kind.SCALAR:r=this.evaluateScalar(t);break;case e.Expr_Kind.REF:r=this.evaluateRef(t);break;case e.Expr_Kind.OBJ:r=this.evaluateObj(t);break;case e.Expr_Kind.ARR:r=this.evaluateArr(t);break;case e.Expr_Kind.JSON:r=this.evaluateJson(t);break;case e.Expr_Kind.ITER:r=this.evaluateIter(t);break;case e.Expr_Kind.ELEM:r=this.evaluateElem(t);break;case e.Expr_Kind.CALL:r=this.evaluateCall(t);break;case e.Expr_Kind.CASES:r=this.evaluateCases(t);break;case e.Expr_Kind.OP_UNARY:r=this.evaluateOpUnary(t);break;case e.Expr_Kind.OP_BINARY:r=this.evaluateOpBinary(t);break;case e.Expr_Kind.OP_VARIADIC:r=this.evaluateOpVariadic(t)}try{this.config.afterEvaluate(t,r)}catch(r){return a.create(G,{status:e.EvaluateOutput_Status.UNKNOWN_ERROR,errorPath:t.expr.path,errorMessage:`afterEvaluate failed: ${r instanceof Error?r.message:JSON.stringify(r)}`})}return r}evaluateEval(e){let t=e.defStack;const r=e.expr.eval?.where??[];for(const e of r)t=oe(t,e);return this.evaluateExpr(a.create(W,{defStack:t,expr:e.expr.eval.eval}))}evaluateScalar(e){return a.create(G,{value:e.expr.scalar.scalar})}evaluateRef(e){const t=e.expr.ref;let r=pe(e.defStack,t.ident);if(!r){const a=this.config.extension.get(t.ident);return a?a(e.expr.path,{}):Se(e.expr.path,t.ident)}return this.evaluateExpr(a.create(W,{defStack:r,expr:r.def.body}))}evaluateObj(t){const r={};for(const[u,n]of Object.entries(t.expr.obj.obj)){const s=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:n}));if(s.status!==e.EvaluateOutput_Status.OK)return s;r[u]=s.value}return a.create(G,{value:ie(r)})}evaluateArr(t){const r=[];for(const u of t.expr.arr.arr){const n=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:u}));if(n.status!==e.EvaluateOutput_Status.OK)return n;r.push(n.value)}return a.create(G,{value:Ee(r)})}evaluateJson(e){return a.create(G,{value:e.expr.json.json})}evaluateIter(t){const r=t.expr.iter,u=r.posIdent,n=r.elemIdent,s=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:r.col}));switch(s.value.type){case e.Value_Type.STR:const c=[];for(let o=0;o<s.value.str.length;o++){let p=t.defStack;if(p=oe(p,le(t.expr.path,u,he(o))),p=oe(p,le(t.expr.path,n,ye(s.value.str[o]))),r.if){const t=this.evaluateExpr(a.create(W,{defStack:p,expr:r.if}));if(t.status!==e.EvaluateOutput_Status.OK)return t;if(t.value.type!==e.Value_Type.BOOL)return ge(r.if.path,t.value.type,[e.Value_Type.BOOL]);if(!t.value.bool)continue}const l=this.evaluateExpr(a.create(W,{defStack:p,expr:r.do}));if(l.status!==e.EvaluateOutput_Status.OK)return l;c.push(l.value)}return a.create(G,{value:Ee(c)});case e.Value_Type.ARR:const o=[];for(let c=0;c<s.value.arr.length;c++){let p=t.defStack;if(p=oe(p,le(t.expr.path,u,he(c))),p=oe(p,le(t.expr.path,n,s.value.arr[c])),r.if){const t=this.evaluateExpr(a.create(W,{defStack:p,expr:r.if}));if(t.status!==e.EvaluateOutput_Status.OK)return t;if(t.value.type!==e.Value_Type.BOOL)return ge(r.if.path,t.value.type,[e.Value_Type.BOOL]);if(!t.value.bool)continue}const l=this.evaluateExpr(a.create(W,{defStack:p,expr:r.do}));if(l.status!==e.EvaluateOutput_Status.OK)return l;o.push(l.value)}return a.create(G,{value:Ee(o)});case e.Value_Type.OBJ:const p={};for(const c of me(s.value.obj)){let o=t.defStack;if(o=oe(o,le(t.expr.path,u,ye(c))),o=oe(o,le(t.expr.path,n,s.value.obj[c])),r.if){const t=this.evaluateExpr(a.create(W,{defStack:o,expr:r.if}));if(t.status!==e.EvaluateOutput_Status.OK)return t;if(t.value.type!==e.Value_Type.BOOL)return ge(r.if.path,t.value.type,[e.Value_Type.BOOL]);if(!t.value.bool)continue}const l=this.evaluateExpr(a.create(W,{defStack:o,expr:r.do}));if(l.status!==e.EvaluateOutput_Status.OK)return l;p[c]=l.value}return a.create(G,{value:ie(p)});default:return ge(r.col.path,s.value.type,[e.Value_Type.STR,e.Value_Type.ARR,e.Value_Type.OBJ])}}evaluateElem(t){const r=t.expr.elem,u=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:r.get}));if(u.status!==e.EvaluateOutput_Status.OK)return u;const n=u.value,s=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:r.from}));if(s.status!==e.EvaluateOutput_Status.OK)return s;const c=s.value;switch(c.type){case e.Value_Type.STR:if(n.type!==e.Value_Type.NUM)return ge(r.get.path,n.type,[e.Value_Type.NUM]);if(!_e(n))return Ve(r.get.path,n.num);const t=Math.floor(n.num);return t<0||t>=c.str.length?Oe(r.get.path,n,0,c.str.length):a.create(G,{value:ye(c.str[t])});case e.Value_Type.ARR:if(n.type!==e.Value_Type.NUM)return ge(r.get.path,n.type,[e.Value_Type.NUM]);if(!_e(n))return Ve(r.get.path,n.num);const u=Math.floor(n.num);return u<0||u>=c.arr.length?Oe(r.get.path,n,0,c.arr.length):a.create(G,{value:c.arr[u]});case e.Value_Type.OBJ:if(n.type!==e.Value_Type.STR)return ge(r.get.path,n.type,[e.Value_Type.STR]);const s=n.str;return s in c.obj?a.create(G,{value:c.obj[s]}):function(t,r,u){return a.create(G,{status:e.EvaluateOutput_Status.INVALID_INDEX,errorPath:t,errorMessage:`invalid key: "${r}" not in {${u.join(",")}}`})}(r.get.path,s,Object.keys(c.obj));default:return ge(r.from.path,c.type,[e.Value_Type.STR,e.Value_Type.ARR,e.Value_Type.OBJ])}}evaluateCall(t){const r=t.expr.call;let u=pe(t.defStack,r.ident);if(!u){const u=this.config.extension.get(r.ident);if(!u)return Se(t.expr.path,r.ident);const n={};for(const[u,s]of Object.entries(r.args)){const r=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:s}));if(r.status!==e.EvaluateOutput_Status.OK)return r;n[u]=r.value}return u(t.expr.path,n)}const n=u.def;for(const s of n.args){const n=r.args[s];if(!n)return fe(t.expr.path,s);const c=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:n}));if(c.status!==e.EvaluateOutput_Status.OK)return c;u=oe(u,le(ee(t.expr.path,r.ident,s),s,c.value))}return this.evaluateExpr(a.create(W,{defStack:u,expr:n.body}))}evaluateCases(t){const r=t.expr.cases.cases;for(const u of r){if(u.isOtherwise)return this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:u.otherwise}));{const r=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:u.when}));if(r.status!==e.EvaluateOutput_Status.OK)return r;if(r.value.type!==e.Value_Type.BOOL)return ge(u.when.path,r.value.type,[e.Value_Type.BOOL]);if(r.value.bool)return this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:u.then}))}}return u=ee(t.expr.path,"cases"),a.create(G,{status:e.EvaluateOutput_Status.CASES_NOT_EXHAUSTIVE,errorPath:u,errorMessage:"cases not exhaustive"});var u}evaluateOpUnary(t){const r=t.expr.opUnary,u=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:r.operand}));if(u.status!==e.EvaluateOutput_Status.OK)return u;const n=u.value;switch(r.op){case e.OpUnary_Op.LEN:switch(n.type){case e.Value_Type.STR:return a.create(G,{value:he(n.str.length)});case e.Value_Type.ARR:return a.create(G,{value:he(n.arr.length)});case e.Value_Type.OBJ:return a.create(G,{value:he(Object.keys(n.obj).length)});default:return ge(ee(t.expr.path,"len"),n.type,[e.Value_Type.STR,e.Value_Type.ARR,e.Value_Type.OBJ])}case e.OpUnary_Op.NOT:return n.type!==e.Value_Type.BOOL?ge(ee(t.expr.path,"not"),n.type,[e.Value_Type.BOOL]):a.create(G,{value:de(!n.bool)});case e.OpUnary_Op.FLAT:if(n.type!==e.Value_Type.ARR)return ge(ee(t.expr.path,"flat"),n.type,[e.Value_Type.ARR]);const u=[];for(const a of n.arr){if(a.type!==e.Value_Type.ARR)return ge(ee(t.expr.path,"flat"),a.type,[e.Value_Type.ARR]);u.push(...a.arr)}return a.create(G,{value:Ee(u)});case e.OpUnary_Op.FLOOR:return n.type!==e.Value_Type.NUM?ge(ee(t.expr.path,"floor"),n.type,[e.Value_Type.NUM]):a.create(G,{value:he(Math.floor(n.num))});case e.OpUnary_Op.CEIL:return n.type!==e.Value_Type.NUM?ge(ee(t.expr.path,"ceil"),n.type,[e.Value_Type.NUM]):a.create(G,{value:he(Math.ceil(n.num))});case e.OpUnary_Op.ABORT:return n.type!==e.Value_Type.STR?ge(ee(t.expr.path,"abort"),n.type,[e.Value_Type.STR]):a.create(G,{status:e.EvaluateOutput_Status.ABORTED,errorMessage:n.str});default:throw new Error(`unexpected unary operator ${e.OpUnary_Op[r.op]}`)}}evaluateOpBinary(t){const r=t.expr.opBinary,u=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:r.left}));if(u.status!==e.EvaluateOutput_Status.OK)return u;const n=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:r.right}));if(n.status!==e.EvaluateOutput_Status.OK)return n;const s=u.value,c=n.value;switch(r.op){case e.OpBinary_Op.SUB:if(s.type!==e.Value_Type.NUM)return ge(ee(t.expr.path,"sub",0),s.type,[e.Value_Type.NUM]);if(c.type!==e.Value_Type.NUM)return ge(ee(t.expr.path,"sub",1),c.type,[e.Value_Type.NUM]);const u=s.num-c.num;return isFinite(u)?a.create(G,{value:he(u)}):Be(t.expr.path);case e.OpBinary_Op.DIV:if(s.type!==e.Value_Type.NUM)return ge(ee(t.expr.path,"div",0),s.type,[e.Value_Type.NUM]);if(c.type!==e.Value_Type.NUM)return ge(ee(t.expr.path,"div",1),c.type,[e.Value_Type.NUM]);const n=s.num/c.num;return isFinite(n)?a.create(G,{value:he(n)}):Be(t.expr.path);case e.OpBinary_Op.EQ:return a.create(G,{value:Re(s,c)});case e.OpBinary_Op.NEQ:return a.create(G,{value:de(!Re(s,c).bool)});case e.OpBinary_Op.LT:const o=ve(ee(t.expr.path,"lt"),s,c);return o.status!==e.EvaluateOutput_Status.OK?o:a.create(G,{value:de(o.value.num<0)});case e.OpBinary_Op.LTE:const p=ve(ee(t.expr.path,"lte"),s,c);return p.status!==e.EvaluateOutput_Status.OK?p:a.create(G,{value:de(p.value.num<=0)});case e.OpBinary_Op.GT:const l=ve(ee(t.expr.path,"gt"),s,c);return l.status!==e.EvaluateOutput_Status.OK?l:a.create(G,{value:de(l.value.num>0)});case e.OpBinary_Op.GTE:const i=ve(ee(t.expr.path,"gte"),s,c);return i.status!==e.EvaluateOutput_Status.OK?i:a.create(G,{value:de(i.value.num>=0)});default:throw new Error(`unexpected binary operator ${e.OpBinary_Op[r.op]}`)}}evaluateOpVariadic(t){const r=t.expr.opVariadic,u=[];for(const n of r.operands){const r=this.evaluateExpr(a.create(W,{defStack:t.defStack,expr:n}));if(r.status!==e.EvaluateOutput_Status.OK)return r;u.push(r.value)}switch(r.op){case e.OpVariadic_Op.ADD:let n=0;for(let a=0;a<u.length;a++){const r=u[a];if(r.type!==e.Value_Type.NUM)return ge(ee(t.expr.path,"add",a),r.type,[e.Value_Type.NUM]);n+=r.num}return isFinite(n)?a.create(G,{value:he(n)}):Be(ee(t.expr.path,"add"));case e.OpVariadic_Op.MUL:let s=1;for(let a=0;a<u.length;a++){const r=u[a];if(r.type!==e.Value_Type.NUM)return ge(ee(t.expr.path,"mul",a),r.type,[e.Value_Type.NUM]);s*=r.num}return isFinite(s)?a.create(G,{value:he(s)}):Be(ee(t.expr.path,"mul"));case e.OpVariadic_Op.AND:for(let r=0;r<u.length;r++){const n=u[r];if(n.type!==e.Value_Type.BOOL)return ge(ee(t.expr.path,"and",r),n.type,[e.Value_Type.BOOL]);if(!n.bool)return a.create(G,{value:de(!1)})}return a.create(G,{value:de(!0)});case e.OpVariadic_Op.OR:for(let r=0;r<u.length;r++){const n=u[r];if(n.type!==e.Value_Type.BOOL)return ge(ee(t.expr.path,"or",r),n.type,[e.Value_Type.BOOL]);if(n.bool)return a.create(G,{value:de(!0)})}return a.create(G,{value:de(!1)});case e.OpVariadic_Op.CAT:let c="";for(let a=0;a<u.length;a++){const r=u[a];if(r.type!==e.Value_Type.STR)return ge(ee(t.expr.path,"cat",a),r.type,[e.Value_Type.STR]);c+=r.str}return a.create(G,{value:ye(c)});case e.OpVariadic_Op.MIN:let o=1/0;for(let a=0;a<u.length;a++){const r=u[a];if(r.type!==e.Value_Type.NUM)return ge(ee(t.expr.path,"min",a),r.type,[e.Value_Type.NUM]);o=Math.min(o,r.num)}return a.create(G,{value:he(o)});case e.OpVariadic_Op.MAX:let p=-1/0;for(let a=0;a<u.length;a++){const r=u[a];if(r.type!==e.Value_Type.NUM)return ge(ee(t.expr.path,"max",a),r.type,[e.Value_Type.NUM]);p=Math.max(p,r.num)}return a.create(G,{value:he(p)});case e.OpVariadic_Op.MERGE:const l={};for(let a=0;a<u.length;a++){const r=u[a];if(r.type!==e.Value_Type.OBJ)return ge(ee(t.expr.path,"merge",a),r.type,[e.Value_Type.OBJ]);Object.assign(l,r.obj)}return a.create(G,{value:ie(l)});default:throw new Error(`unexpected variadic operator ${e.OpVariadic_Op[r.op]}`)}}},e.ExprSchema=O,e.Expr_KindSchema=S,e.Expr_PathSchema=V,e.Expr_Path_PosSchema=g,e.IterSchema=C,e.JsonSchema=I,e.ObjSchema=R,e.OpBinarySchema=L,e.OpBinary_OpSchema=j,e.OpUnarySchema=N,e.OpUnary_OpSchema=K,e.OpVariadicSchema=D,e.OpVariadic_OpSchema=J,e.ParseInputSchema=P,e.ParseOutputSchema=$,e.Parser=class{parse(e){try{return a.create($,{expr:se(a.create(V),e.value)})}catch(e){return a.create($,{isError:!0,errorMessage:e instanceof Error?e.message:JSON.stringify(e)})}}},e.RefSchema=m,e.ScalarSchema=_,e.ValueSchema=n,e.Value_TypeSchema=c,e.append=ee,e.arrValue=Ee,e.boolValue=de,e.find=pe,e.format=te,e.newDefinition=le,e.numValue=he,e.objValue=ie,e.register=oe,e.strValue=ye}));